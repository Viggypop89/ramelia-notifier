name: Ramelia Lotstid Monitor

on:
  schedule:
    - cron: '13 * * * *'
  workflow_dispatch:

jobs:
  check-ramelia:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout kod
      uses: actions/checkout@v4
      
    - name: Återställ tidigare tillstånd
      uses: actions/cache/restore@v3
      continue-on-error: true
      with:
        path: ramelia_state.json
        key: ramelia-state-${{ github.run_number }}
        restore-keys: ramelia-state-
      
    - name: Sätt upp Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Installera dependencies
      run: pip install playwright requests google-auth && playwright install chromium && playwright install-deps chromium
      
    - name: Kör scraper
      env:
        FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
      run: python web_scraper.py
      
    - name: Spara tillstånd
      uses: actions/cache/save@v3
      if: always()
      with:
        path: ramelia_state.json
        key: ramelia-state-${{ github.run_number }}
